# Xv6 and Unix utilities

本节内容主要目的是让我们熟悉 xv6 及其系统调用。其中，系统调用与 Unix 系统非常类
似，可以看作是 Unix 同名系统调用的简化版。

## 启动 xv6

按照说明安装环境，编译、启动即可。这里注意 Ubuntu 系统软件源中的 qemu 可能是旧版，
在实验中会出现 bug，所以需要编译安装版本较新的 qemu。

## sleep 

直接调用 `sleep` 这一系统调用即可。这里注意 `sleep` 仅接收 `int` 类型参数，因此
需要使用 `atoi` 函数进行类型转换。

## pingpong

`fork` 函数与管道的小试牛刀。管道使用 `pipe` 函数建立，其参数为一个 `int` 类型、
长度为 2 的数组。数组的第一个元素为管道读端的文件描述符，第二个元素为写端的文件
描述符。xv6 的系统资源相对于我们日常使用的计算机而言十分有限，因此在实验中需要注
意使用 `close` 及时关闭不再需要使用的文件。

## primes

较为有难度的一个实验。题目要求实现一个多进程版的素数筛。其流程是：

1. 构建一个 [2, 36] 的数组。
2. 若数组第一个元素为 35（即 [2, 36] 中最大的素数），则输出，程序中止；否则，生
   成子进程并传入数组。
3. 每个子进程执行如下操作：首先，接收上一进程输入的数组，输出数组的第一个元素。
   然后，对数组中的每一个元素，若其能被数组第一个元素整除，则将其舍弃。最后，将
   数组传递给下一个进程。

![素数筛](https://swtch.com/~rsc/thread/sieve.gif)

完成实验程序需要细心与认真。在读取管道时，若写端已关闭，则 `read` 函数返回 0。

## find

参照 xv6 提供的 `ls` 实现代码完成即可。这里需要格外注意关闭不再需要的文件，否则
会由于系统资源不够而产生奇怪的错误。

## xargs

实验代码需要将标准输入的内容读入，并作为参数传递给待执行程序。本解法的思路为：将
标准输入的内容按空格与换行符划分，将划分后形成的每一个字符串作为参数保存。由于难
以预知参数个数，将参数数组 `params` 定义为二维数组指针，再使用 `malloc` 分配内存、
`memcpy` 写入内存。
